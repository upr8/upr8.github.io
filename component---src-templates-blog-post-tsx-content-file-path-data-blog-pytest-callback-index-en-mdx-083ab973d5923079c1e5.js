"use strict";(self.webpackChunkpersonal_web_site=self.webpackChunkpersonal_web_site||[]).push([[341],{3961:function(e,n,t){t.r(n),t.d(n,{Head:function(){return m.F},default:function(){return h}});var a=t(1151),l=t(7294);function c(e){const n=Object.assign({h2:"h2",a:"a",span:"span",p:"p",code:"code",pre:"pre",h3:"h3"},(0,a.ah)(),e.components);return l.createElement(l.Fragment,null,l.createElement(n.h2,{id:"introduction",style:{position:"relative"}},"Introduction",l.createElement(n.a,{href:"#introduction","aria-label":"introduction permalink",className:"autolink-hdrs after"},l.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}}))),"\n",l.createElement(n.p,null,"When it comes to detecting events within a function, callback functions offer a reliable approach. By passing a function pointer along with other arguments, you can ensure that a specific function is executed when a particular event occurs. While this pattern is widely used in structured languages like C, it is less prevalent in languages such as Python. However, there are libraries in Python that make use of this pattern to address certain challenges."),"\n",l.createElement(n.p,null,"Recently, I encountered a situation where I needed to utilize a library that employed callback functions. In this blog post, we will explore this library and dive into its testing methodology, utilizing the Pytest library. By understanding how to effectively test callback functions, we can ensure their proper functionality and enhance the reliability of our codebase."),"\n",l.createElement(n.h2,{id:"prepare-the-running-environment",style:{position:"relative"}},"Prepare the running environment",l.createElement(n.a,{href:"#prepare-the-running-environment","aria-label":"prepare the running environment permalink",className:"autolink-hdrs after"},l.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}}))),"\n",l.createElement(n.p,null,"For running the following codes, I used ",l.createElement(n.code,null,"python-3.10")," and ",l.createElement(n.code,null,"pytest")," package. You can\ninstall ",l.createElement(n.code,null,"pytest")," using the following code:"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-bash"},"pip install pytest\n")),"\n",l.createElement(n.h2,{id:"a-use-case-call-a-function-on-every-even-number",style:{position:"relative"}},"A use-case: call a function on every even number",l.createElement(n.a,{href:"#a-use-case-call-a-function-on-every-even-number","aria-label":"a use case call a function on every even number permalink",className:"autolink-hdrs after"},l.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}}))),"\n",l.createElement(n.p,null,"The function ",l.createElement(n.code,null,"process_even_numbers")," takes two parameters: ",l.createElement(n.code,null,"numbers"),", which is the input array of numbers, and ",l.createElement(n.code,null,"callback"),", which is the function to be called for each even number."),"\n",l.createElement(n.p,null,"Within the function, we iterate over each element num in the numbers array. Using the modulo operator %, we check if num is divisible by 2, i.e., an even number. If it is, we call the ",l.createElement(n.code,null,"callback")," function and pass the even number num as an argument."),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-python"},"def process_even_numbers(numbers, callback):\n    for num in numbers:\n        if num % 2 == 0:\n            callback(num)\n")),"\n",l.createElement(n.p,null,"This simple function can be called within the following code:"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-python"},'def print_number(num):\n    print(f"Even number: {num}")\n\nnumbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\n\nprocess_even_numbers(numbers, print_number)\n')),"\n",l.createElement(n.h3,{id:"testing-the-function-without-pytest-mock",style:{position:"relative"}},"Testing the function: without Pytest-mock",l.createElement(n.a,{href:"#testing-the-function-without-pytest-mock","aria-label":"testing the function without pytest mock permalink",className:"autolink-hdrs after"},l.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}}))),"\n",l.createElement(n.p,null,"A very basic approach can be writing a custom class that can play the role of\na stub function, like the following ",l.createElement(n.code,null,"mock_callback_class")," class:"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-python"},"class mock_callback_class:\n    def __init__(self):\n        self.callback_called = False\n    \n    def __call__(self, num):\n        self.callback_called = True\n    \n    def reset(self):\n        self.callback_called = False\n")),"\n",l.createElement(n.p,null,"And then we can use ",l.createElement(n.code,null,"pytest")," to write different test cases for this function such as the following code:"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-python"},"def test_empty_array():\n    mock_callback = mock_callback_class()\n\n    # Test case 1: Empty array\n    numbers = []\n    process_even_numbers(numbers, mock_callback)\n    assert not mock_callback.callback_called\n\ndef test_array_with_even_numbers():\n    mock_callback = mock_callback_class()\n\n    # Test case 2: Array with even numbers\n    numbers = [2, 5, 8, 11, 14]\n\n    process_even_numbers(numbers, mock_callback)\n    assert mock_callback.callback_called == True\n\ndef test_array_with_no_even_numbers():\n    mock_callback = mock_callback_class()\n\n    # Test case 3: Array with no even numbers\n    numbers = [1, 3, 5, 7, 9]\n\n    process_even_numbers(numbers, mock_callback)\n    assert not mock_callback.callback_called\n")),"\n",l.createElement(n.p,null,"In this way, we test some aspects of the following code:"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-bash"},"pytest -vv\n")),"\n",l.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1035px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 12.355212355212355%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAbElEQVR42n3MMQ7CMAxA0V63p+nA2mPASRADQiyQGtLERoSiuEjVB7HD8NbXnGJiHyLHayYk5TIIIkIaR1SV6Tnh7j9Vryy+0O062lVLE9U4SOCcM3Z/cDPFPpGZfcNSCj7/D+f6Yj1s6Lc9b1Q0lWJ/JFIJAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="Test result for the first approach"\n        title=""\n        src="/static/503c3b85292276c6c851d204384876ba/e3189/test-case-method-1.png"\n        srcset="/static/503c3b85292276c6c851d204384876ba/a2ead/test-case-method-1.png 259w,\n/static/503c3b85292276c6c851d204384876ba/6b9fd/test-case-method-1.png 518w,\n/static/503c3b85292276c6c851d204384876ba/e3189/test-case-method-1.png 1035w,\n/static/503c3b85292276c6c851d204384876ba/4719e/test-case-method-1.png 1330w"\n        sizes="(max-width: 1035px) 100vw, 1035px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n    </span>'}}),"\n",l.createElement(n.p,null,"However, what if we want to verify that the callback function was called with the correct arguments?\nAdditionally, what if we want to check if the callback function was called multiple times?\nWhile we could add these features to our ",l.createElement(n.code,null,"mock_callback_class"),", it brings the question\nof why we should spend time reinventing the wheel."),"\n",l.createElement(n.h3,{id:"testing-the-function-with-pytest-mock",style:{position:"relative"}},"Testing the function: with Pytest-mock",l.createElement(n.a,{href:"#testing-the-function-with-pytest-mock","aria-label":"testing the function with pytest mock permalink",className:"autolink-hdrs after"},l.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}}))),"\n",l.createElement(n.p,null,"For using this library, you can install this package by the following command:"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-bash"},"pip install pytest-mock\n")),"\n",l.createElement(n.p,null,"We can rewrite the test cases in the previous section as follows:"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-python"},"from pytest_mock import MockerFixture\n\ndef test_empty_array(mocker: MockerFixture):\n    mock_callback = mocker.Mock(return_value=None)\n\n    # Test case 1: Empty array\n    numbers = []\n    process_even_numbers(numbers, mock_callback)\n    assert not mock_callback.called\n\ndef test_array_with_even_numbers(mocker: MockerFixture):\n    mock_callback = mocker.Mock(return_value=None)\n\n    # Test case 2: Array with even numbers\n    numbers = [2, 5, 8, 11, 14]\n\n    process_even_numbers(numbers, mock_callback)\n    assert mock_callback.called\n    mock_callback.assert_has_calls(\n        [\n            mocker.call(2),\n            mocker.call(8),\n            mocker.call(14)\n        ],\n        any_order=False,\n    )\n\ndef test_array_with_no_even_numbers(mocker: MockerFixture):\n    mock_callback = mocker.Mock(return_value=None)\n\n    # Test case 3: Array with no even numbers\n    numbers = [1, 3, 5, 7, 9]\n\n    process_even_numbers(numbers, mock_callback)\n    assert not mock_callback.called\n")),"\n",l.createElement(n.p,null,"As you can see, in ",l.createElement(n.code,null,"test_array_with_even_numbers")," we checked the number of calls\nand their argument. Using ",l.createElement(n.code,null,"pytest-mock")," gives us a lot of features that we can use\nin different use cases."),"\n",l.createElement(n.p,null,"By running pytest, we can see the same result as the following:"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-bash"},"pytest -vv\n")),"\n",l.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1035px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 11.96911196911197%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAZklEQVR42oXMsQ2DMBQAUVZmGBoqtmASisiVJWyT2N9WIuCb6mJlgFCc9Krr7BZ5rBsmvAhRCN7jnCeJkFuqSq31b5deDMtAP/Z0T8kYv2Jjorw/v0lKzaUgzfux3w7rqcxuZlomvmGulZR6jYJUAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="Test result for the second approach"\n        title=""\n        src="/static/434a324409b6c6dc7c024bd79e6fa2a3/e3189/test-case-method-2.png"\n        srcset="/static/434a324409b6c6dc7c024bd79e6fa2a3/a2ead/test-case-method-2.png 259w,\n/static/434a324409b6c6dc7c024bd79e6fa2a3/6b9fd/test-case-method-2.png 518w,\n/static/434a324409b6c6dc7c024bd79e6fa2a3/e3189/test-case-method-2.png 1035w,\n/static/434a324409b6c6dc7c024bd79e6fa2a3/b1584/test-case-method-2.png 1342w"\n        sizes="(max-width: 1035px) 100vw, 1035px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n    </span>'}}),"\n",l.createElement(n.h2,{id:"conclution",style:{position:"relative"}},"Conclution",l.createElement(n.a,{href:"#conclution","aria-label":"conclution permalink",className:"autolink-hdrs after"},l.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}}))),"\n",l.createElement(n.p,null,"In this article, we investigated the performance of a method of using the ",l.createElement(n.code,null,"pytets-mock"),".\nYou can download the code for the first method from ",l.createElement(n.a,{href:"/files/b5a38856b2c8c1358ebcdf651be318bc/test_callback_class.py"},"(test_callback_class.py)"),"\nand the code for the second method from ",l.createElement(n.a,{href:"/files/e78866b21ce0883c192e347ca017ebb4/test_callback_mock.py"},"(test_callback_mock.py)"),"."),"\n",l.createElement(n.p,null,"To view the documents related to the ",l.createElement(n.code,null,"pytest"),", you can check its ",l.createElement(n.a,{href:"https://pytest-mock.readthedocs.io/en/latest/"},"documentation website"),"."))}var s=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,a.ah)(),e.components);return n?l.createElement(n,e,l.createElement(c,e)):c(e)},r=t(6053),i=t(8890),o=t(6587),m=t(8071);const u=e=>{var n,t,a,c,s,m;let{data:u,pageContext:h,children:d}=e;const p=null!==(n=u.mdx)&&void 0!==n&&n.tableOfContents?{TableOfContents:null===(t=u.mdx)||void 0===t?void 0:t.tableOfContents}:{};return l.createElement(i.Z,{pageContext:h},l.createElement(r.Z,p,d),(null===(a=u.mdx)||void 0===a||null===(c=a.fields)||void 0===c?void 0:c.slugTagList)&&l.createElement("div",{className:"mt-32"},l.createElement("p",{className:"mt-8 text-center text-secondary"},"Tags of this Post:"),l.createElement(o.P,{tags:null===(s=u.mdx)||void 0===s||null===(m=s.fields)||void 0===m?void 0:m.slugTagList})))};function h(e){return l.createElement(u,e,l.createElement(s,e))}},6587:function(e,n,t){t.d(n,{P:function(){return c}});var a=t(7294),l=t(1883);var c=e=>{let{tags:n,isCenter:t=!0}=e;return a.createElement("ul",{className:"flex flex-wrap items-baseline mt-2 ms-1 md:mt-0 "+(t?"justify-center":"justify-start")},null==n?void 0:n.map((e=>a.createElement("li",{key:null==e?void 0:e.tag,className:"z-10 inline-block px-2 m-1 text-sm border-2 rounded-full shadow-sm bg-nav text-primary"},a.createElement(l.Link,{to:""+(null==e?void 0:e.slug)},"#",null==e?void 0:e.tag)))))}}}]);
//# sourceMappingURL=component---src-templates-blog-post-tsx-content-file-path-data-blog-pytest-callback-index-en-mdx-083ab973d5923079c1e5.js.map